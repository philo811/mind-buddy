<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Buddy </title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* --- 1. GLOBAL RESET & LAYOUT --- */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #FEF6E3; /* Original Lighter Beige */
            color: #333;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* App container handles scroll */
        }

        .app-container {
            display: flex;
            width: 100%;
            height: 100%;
            background-color: #FEF6E3; /* Original Lighter Beige */
            position: relative; 
        }

        /* --- 2. SIDEBAR --- */
        .sidebar {
            width: 220px;
            min-width: 220px;
            background-color: #ffffff; 
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e6ed;
            z-index: 100;
            transition: margin-left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #5c9e5c;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
        }

        .sidebar-nav {
            flex-grow: 1; /* Pushes content below it to the bottom */
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            color: #555;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .nav-item:hover, .nav-item.active {
            background-color: #e5fde5;
            color: #5c9e5c;
        }
        .nav-item i { margin-right: 15px; width: 20px; text-align: center; }

        /* --- 3. MAIN CONTENT AREA --- */
        .content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #FEF6E3; /* Original Lighter Beige */
            overflow: hidden; 
            position: relative; 
            transition: background-color 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); /* Smoother transition */
        }

        /* Header */
        .main-header {
            height: 70px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            padding: 0 30px;
            background-color: transparent; /* Transparent to show content-area bg */
            z-index: 50;
            /* Removed transition here, relying on parent */
        }
        
        .header-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .menu-toggle-btn {
            display: none; /* Hidden on desktop */
            margin-right: 20px;
            background: none;
            border: none;
            font-size: 1.5em;
            color: #5c9e5c;
            cursor: pointer;
        }

        /* Scrollable Grid */
        .dashboard-grid {
            flex-grow: 1;
            overflow-y: auto; /* ENABLE SCROLLING HERE */
            padding: 0; /* Removed padding from grid to allow full-width backgrounds */
            box-sizing: border-box;
        }

        .dashboard-panel {
            display: none; 
            width: 100%;
            min-height: 100%; /* Ensure panel takes full height */
            flex-direction: column;
            align-items: center;
            padding: 30px; 
            box-sizing: border-box;
            /* Backgrounds removed from panels to allow smooth parent transition */
        }
        .dashboard-panel.active { display: flex; }

        /* --- 4. PANEL SPECIFIC STYLES --- */

        /* Home */
        #home { text-align: center; padding-top: 20px; }
        .home-logo img {
            max-width: 250px;
            width: 100%;
            animation: floatAnimation 4s ease-in-out infinite;
        }
        .make-today-count {
            font-size: 32px;
            color: #F4A700;
            text-shadow: 2px 2px 0px #A71515;
            margin: 40px;
        }
        .join-us-btn {
            background-color: #80be80;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .join-us-btn:hover { transform: translateY(-2px); background-color: #499649; }
        .join-us-btn:active {transform: scale(0.99);}

        /* Mood Tracker */
        /* #mood background handled by JS/Parent now */
        .mood-layout-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
            max-width: 1200px; /* Constrain content width */
            align-items: flex-start;
            justify-content: center;
            margin-top: 20px;
        }
        .mood-table-container {
            flex: 2;
            min-width: 300px;
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            overflow-x: auto; /* Allow scrolling on small screens for wide tables */
        }
        .mood-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; min-width: 500px; }
        .mood-table th { text-align: left; color: #6a1b9a; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .mood-table td { padding: 10px 5px; border-bottom: 1px solid #f9f9f9; }
        
        /* Clean checkboxes */
        .mood-checkbox {
            width: 20px; height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            display: inline-flex; justify-content: center; align-items: center;
            cursor: pointer; color: white; font-size: 12px;
            margin: 0 auto; display: block;
        }
        .mood-checkbox.checked { background-color: #4CAF50; border-color: #4CAF50; }

        .mood-quote-box {
            background-color: #FBE040;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
            flex: 1;
            min-width: 250px;
            transition: background-color 0.3s ease; /* Smooth color transition */
        }

        /* Study Planner */
        /* #study background handled by JS/Parent now */
        
        .planner-layout {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
            max-width: 1200px; /* Constrain content width */
            justify-content: center;
        }
        .planner-left { flex: 2; min-width: 300px; }
        .planner-right { flex: 1; min-width: 300px; }

        .add-task-area {
            display: flex;
            gap: 10px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            align-items: center;
        }
        .add-task-area input[type="text"] {
            flex-grow: 1; border: 1px solid #ddd; padding: 10px; border-radius: 5px; outline: none;
        }
        .add-task-area input[type="time"] {
            border: 1px solid #ddd; padding: 10px; border-radius: 5px; outline: none; cursor: pointer;
        }

        .task-list { list-style: none; padding: 0; margin-top: 20px; }
        .task-item {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            transition: all 0.3s ease;
        }
        .task-item.completed {
            background-color: #e8f5e9;
            opacity: 0.8;
        }
        .task-item.completed span {
            text-decoration: line-through;
            color: #888;
        }
        .task-time {
            background: #e0f7fa; color: #006064; padding: 4px 8px; border-radius: 4px; font-size: 0.85em; font-weight: 600; margin-right: 10px;
        }
        .task-actions {
            display: flex;
            gap: 10px;
        }
        .task-action-btn {
            background: none; border: none; cursor: pointer; font-size: 1.1em; transition: transform 0.2s;
        }
        .task-action-btn:hover { transform: scale(1.2); }
        .btn-check { color: #ccc; }
        .btn-check:hover { color: #4CAF50; }
        .task-item.completed .btn-check { color: #4CAF50; } /* Green check when completed */
        .btn-delete { color: #ef5350; }

        /* Calendar */
        .calendar-widget { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .calendar-header { display: flex; justify-content: space-between; font-weight: 700; margin-bottom: 15px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .calendar-grid div { padding: 8px 0; cursor: pointer; border-radius: 5px; font-size: 0.9em; }
        .calendar-grid div:hover { background-color: #f0f0f0; }
        .calendar-grid div.selected { background-color: #6a1b9a; color: white; }
        .calendar-grid div.has-tasks { border-bottom: 3px solid #00bcd4; }

        /* Focus Timer */
        /* #focus background handled by JS/Parent now */
        
        .timer-header {
            font-size: 40px;
            font-weight: 600;
            color: black;
            text-shadow: 2px 2px 2px #C7A9A9;
            margin-bottom: 30px;
            text-align: center;
        }

        .timer-container {
            display: flex; flex-direction: column; align-items: center; margin-top: 20px;
        }
        .circular-timer {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: conic-gradient(#ffeb3b 50%, #e0f2f1 0%); 
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 0 15px #00bcd4;
            margin-bottom: 30px;
        }
        .timer-inner {
            background: white;
            width: 90%;
            height: 90%;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .timer-time { font-size: 3.5em; font-weight: 700; color: #333; }

        .timer-session-label {
            font-size: 1.2em;
            color: #666;
            font-weight: 500;
        }
        
        .timer-controls { display: flex; gap: 15px; }
        .timer-btn {
            padding: 10px 25px; 
            border: none; 
            border-radius: 8px; 
            font-weight: 600; 
            cursor: pointer; 
            font-size: 1rem;
            margin-top: 10px;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease; 
        }
        
        .timer-btn:hover {
            transform: translateY(-3px); /* Moves button up slightly */
            box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* Adds a soft shadow */
        }

        /* Button Colors and Hover Colors (Darker on Hover) */
        .btn-start { background-color: #5DAF61; color: white; }
        .btn-start:hover { background-color: #43A047; } /* Darker Green */
        .btn-start:active {transform: scale(0.99);}

        .btn-pause { background-color: #ffdd44; color: #333; }
        .btn-pause:hover { background-color: #ffd415; } /* Darker Yellow */
        .btn-pause:active {transform: scale(0.99);}

        .btn-break { background-color: #E53935; color: white; }
        .btn-break:hover { background-color: #C62828; } /* Darker Cyan */
        .btn-break:active {transform: scale(0.99);}

        .btn-reset { background-color: #757575; color: white; }
        .btn-reset:hover { background-color: #616161; } /* Darker Grey */
        .btn-reset:active {transform: scale(0.99);}

        /* Mascot - Fixed (No Rotation) */
        .page-buddy {
            position: absolute; width: 100px; z-index: 10; opacity: 0.9; pointer-events: none;
        }
        #mood-buddy { bottom: 20px; right: 20px; animation: bounceIn 1s ease-out;}
        #study-buddy { top: 90px; right: 30px; transform: scaleX(-1); animation: peekAnimation 1.2s ease-out;}
        #focus-buddy { bottom: 30px; left: 30px; opacity: 0.8; animation: bounceIn 1s ease-out;}

        /* Animations */
        @keyframes floatAnimation {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3) translateY(50px); }
            50% { opacity: 1; transform: scale(1.05) translateY(0); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        
        @keyframes peekAnimation {
            from { transform: translateX(100px) scaleX(-1); opacity: 0; }
            to { transform: translateX(0) scaleX(-1); opacity: 0.8; }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar { position: absolute; margin-left: -220px; height: 100%; box-shadow: 5px 0 15px rgba(0,0,0,0.1); }
            .sidebar.show { margin-left: 0; }
            .menu-toggle-btn { display: block; }
            .planner-layout, .mood-layout-container { flex-direction: column; }
            .planner-right { order: -1; width: 100%; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <img src="task2.webp" alt="Mind Buddy logo" style="width: 53px;"> <span style="margin: 5px;color: #5c9e5c;">Mind Buddy</span>
        </div>
        <nav class="sidebar-nav">
            <a href="#home" class="nav-item active"><i class="fas fa-home"></i> Home</a>
            <a href="#mood" class="nav-item"><i class="far fa-smile"></i> Mood</a>
            <a href="#study" class="nav-item"><i class="fas fa-calendar-alt"></i> Study</a>
            <a href="#focus" class="nav-item"><i class="fas fa-hourglass-half"></i> Focus</a>
        </nav>
        <!-- Added Join Us button back to sidebar -->
        <div id="sidebar-auth-section" style="margin-top: 20px;">
            <a href="LoginPage.html"><button class="join-us-btn" style="width: 100%;">Join Us</button></a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="content-area">
        <header class="main-header">
            <button class="menu-toggle-btn" id="menu-toggle"><i class="fas fa-bars"></i></button>
            <h2 class="header-title" id="page-title">Home</h2>
        </header>

        <div class="dashboard-grid">

            <!-- 1. HOME PANEL -->
            <section id="home" class="dashboard-panel active">
                <div class="home-logo">
                    <img src="task2.webp" alt="Mind Buddy Logo" onerror="this.src='https://placehold.co/300x200/FEF6E3/A71515?text=Mind+Buddy';">
                </div>
                <div style="max-width: 700px; margin-top: 50px;">
                    <p style="font-size: 1.1em; color: black;text-shadow: 1px 1px 1px #888;line-height: 1.8;font-style: italic;">Mind Buddy is here to help you stay <strong>Focus</strong>, <strong>MOTIVATED</strong>, and on track â€” turning small daily steps into big progress toward your goals.</p>
                </div>
                <h2 class="make-today-count">Make Today Count!</h2>
                <button class="join-us-btn" onclick="switchPanel('#mood')">Start Now <i class="fas fa-arrow-right"></i></button>
                <hr style="width: 50%;border: 0;height: 1px;background-image: linear-gradient(to right, rgba(0, 0, 0, 0), #a71515, rgba(0, 0, 0, 0));margin-top: 40px;">
            </section>

            <!-- 2. MOOD PANEL -->
            <section id="mood" class="dashboard-panel">
                <div class="mood-layout-container">
                    <div class="mood-table-container">
                        <table class="mood-table">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <!-- Replaced words with 6 Emojis from Image -->
                                    <th style="text-align:center;"><i class="far fa-smile" style="color:#FFD700; font-size:1.5rem;"></i></th>
                                    <th style="text-align:center;"><i class="far fa-meh" style="color:#FFC107; font-size:1.5rem;"></i></th>
                                    <th style="text-align:center;"><i class="far fa-frown" style="color:#2196F3; font-size:1.5rem;"></i></th>
                                    <th style="text-align:center;"><i class="far fa-angry" style="color:#F44336; font-size:1.5rem;"></i></th>
                                    <th style="text-align:center;"><i class="far fa-dizzy" style="color:#9C27B0; font-size:1.5rem;"></i></th>
                                    <th style="text-align:center;"><i class="far fa-tired" style="color:#607D8B; font-size:1.5rem;"></i></th>
                                </tr>
                            </thead>
                            <tbody id="mood-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mood-quote-box" id="inspiration-box">
                        "Your mind is a garden. Your thoughts are the seeds. You can grow flowers or you can grow weeds."
                    </div>
                </div>
                <img src="task2.webp" class="page-buddy" id="mood-buddy" onerror="this.style.display='none'">
            </section>

            <!-- 3. STUDY PANEL -->
            <section id="study" class="dashboard-panel">
                <div class="planner-layout">
                    
                    <!-- Left: Tasks -->
                    <div class="planner-left">
                        <div class="add-task-area">
                            <input type="time" id="task-time">
                            <input type="text" id="task-input" placeholder="What needs to be done?">
                            <button class="join-us-btn" style="padding: 10px 20px;" onclick="addTask()">Add</button>
                        </div>
                        
                        <div style="margin-top: 15px; font-weight: 600; color: #6a1b9a;">
                            Tasks for: <span id="selected-date-display" style="text-decoration: underline;">Today</span>
                        </div>

                        <ul class="task-list" id="task-list">
                            <!-- Tasks go here -->
                        </ul>
                    </div>

                    <!-- Right: Calendar -->
                    <div class="planner-right">
                        <div class="calendar-widget">
                            <div class="calendar-header">
                                <span style="cursor:pointer" id="prev-month">&lt;</span>
                                <span id="month-year">Month Year</span>
                                <span style="cursor:pointer" id="next-month">&gt;</span>
                            </div>
                            <div class="calendar-grid">
                                <div>Mo</div><div>Tu</div><div>We</div><div>Th</div><div>Fr</div><div>Sa</div><div>Su</div>
                            </div>
                            <div class="calendar-grid" id="calendar-days">
                                <!-- Days -->
                            </div>
                        </div>
                    </div>
                </div>
                <img src="task2.webp" class="page-buddy" id="study-buddy" onerror="this.style.display='none'">
            </section>

            <!-- 4. FOCUS PANEL -->
            <section id="focus" class="dashboard-panel">
                <h3 class="timer-header">Stay focused â€” you got this ðŸ’ª</h3>
                <div class="timer-container">
                    <div class="circular-timer">
                        <div class="timer-inner">
                            <div class="timer-time" id="timer-display">25:00</div>
                            <p class="timer-session-label" id="timer-session-label">Focus Session</p>
                        </div>
                    </div>
                    
                    <div class="timer-controls">
                        <button class="timer-btn btn-start" onclick="startTimer()">Start</button>
                        <button class="timer-btn btn-pause" onclick="pauseTimer()">Pause</button>
                        <button class="timer-btn btn-break" onclick="setBreak()">Break</button>
                        <button class="timer-btn btn-reset" onclick="resetTimer()">Reset</button>
                    </div>

                    <div style="font-size:1em; color:#666; display:flex; gap:20px;margin-top: 30px;font-size: 17px;">
                        <span>ðŸ’¼ Work: 25 min</span>
                        <span>â˜• Short Break: 5 min</span>
                    </div>
                </div>
                <img src="task2.webp" class="page-buddy" id="focus-buddy" onerror="this.style.display='none'">
            </section>

        </div>
    </main>
</div>

<script>
    // --- 1. AUTH CHECK & USER DATA SEGREGATION ---
    const currentUser = localStorage.getItem('currentUser');

    // If no user is logged in, kick them back to Login Page
    if (!currentUser) {
        window.location.href = 'LoginPage.html';
    }

    // UPDATE SIDEBAR (Remove Join Us -> Show User)
    const authSection = document.getElementById('sidebar-auth-section');
    if(authSection && currentUser) {
        authSection.innerHTML = `
            <div style="text-align: center; color: #555;">
                <p style="margin-bottom: 5px; font-size: 0.9em;">Welcome,</p>
                <h3 style="margin: 0 0 10px 0; color: #5c9e5c;">${currentUser}</h3>
                <button onclick="logout()" style="background: #ef5350; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        `;
    }

    function logout() {
        localStorage.removeItem('currentUser');
        window.location.href = 'LoginPage.html';
    }

    // --- 2. APP STATE & NAVIGATION ---
    const panels = document.querySelectorAll('.dashboard-panel');
    const navItems = document.querySelectorAll('.nav-item');
    const headerTitle = document.getElementById('page-title');
    const sidebar = document.getElementById('sidebar');
    const contentArea = document.querySelector('.content-area');

    const panelBackgrounds = {
        'home': '#FEF6E3', 'mood': '#E9F8F2', 'study': '#E3F2FD', 'focus': '#E1DDF4'
    };

    // Define custom titles for your pages here
    const panelTitles = {
        'home': 'Home',
        'mood': 'Mood Tracker',
        'study': 'Study Planner',
        'focus': 'Focus Timer'
    };

    function switchPanel(hash) {
        const targetId = hash.replace('#', '');
        panels.forEach(p => p.classList.remove('active'));
        navItems.forEach(n => n.classList.remove('active'));
        
        const targetPanel = document.getElementById(targetId);
        const targetNav = document.querySelector(`a[href="#${targetId}"]`);
        
        if(targetPanel) {
            targetPanel.classList.add('active');
            
            headerTitle.textContent = panelTitles[targetId] || targetId.charAt(0).toUpperCase() + targetId.slice(1);
            
            contentArea.style.backgroundColor = panelBackgrounds[targetId] || '#FEF6E3';
        }
        if(targetNav) targetNav.classList.add('active');
        sidebar.classList.remove('show');
    }

    navItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            switchPanel(item.getAttribute('href'));
        });
    });

    document.getElementById('menu-toggle').addEventListener('click', () => sidebar.classList.toggle('show'));

    // --- 3. MOOD TRACKER LOGIC (USER SPECIFIC) ---
    const moodBody = document.getElementById('mood-body');
    const inspirationBox = document.getElementById('inspiration-box');
    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    
    // Create a unique key for this user's mood
    const MOOD_KEY = `mindBuddyMood_${currentUser}`;

    const quotes = {
        'Happy': "Keep shining! Your positivity is contagious. âœ¨",
        'Neutral': "Balance is key. Stay centered and calm. âš–ï¸",
        'Sad': "It's okay not to be okay. Treat yourself with kindness today. â¤ï¸",
        'Angry': "Take a deep breath. Count to ten. Let it go. ðŸŒ¬ï¸",
        'Stressed': "Inhale peace, exhale stress. One step at a time. ðŸŒ¿",
        'Tired': "Rest is productive too. Recharge your batteries. ðŸ”‹"
    };

    const moodColors = {
        'Happy': '#FFF9C4', 'Neutral': '#FFE0B2', 'Sad': '#B3E5FC', 
        'Angry': '#FFCDD2', 'Stressed': '#E1BEE7', 'Tired': '#CFD8DC'
    };

    function getMoodData() {
        return JSON.parse(localStorage.getItem(MOOD_KEY)) || {};
    }

    function saveMoodData(day, mood) {
        const data = getMoodData();
        data[day] = mood;
        localStorage.setItem(MOOD_KEY, JSON.stringify(data));
        renderMoodTable(); // Re-render to show checked state
    }

    function renderMoodTable() {
        const savedData = getMoodData();
        moodBody.innerHTML = '';
        
        days.forEach(day => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${day}</td>`;
            const moods = ['Happy', 'Neutral', 'Sad', 'Angry', 'Stressed', 'Tired'];
            
            moods.forEach(mood => {
                const td = document.createElement('td');
                const check = document.createElement('span');
                check.className = 'mood-checkbox';
                
                // Check if this mood is saved for this day
                if (savedData[day] === mood) {
                    check.classList.add('checked');
                    // If it's today (simple logic), update the quote
                    // Or just update quote based on last interaction
                }

                check.onclick = function() {
                    saveMoodData(day, mood);
                    inspirationBox.textContent = quotes[mood];
                    inspirationBox.style.backgroundColor = moodColors[mood];
                };
                td.appendChild(check);
                row.appendChild(td);
            });
            moodBody.appendChild(row);
        });
    }

    // --- 4. STUDY PLANNER (USER SPECIFIC) ---
    const calendarDays = document.getElementById('calendar-days');
    const monthYear = document.getElementById('month-year');
    const selectedDateDisplay = document.getElementById('selected-date-display');
    const taskList = document.getElementById('task-list');
    
    let currentDate = new Date();
    let selectedDateKey = new Date().toISOString().split('T')[0]; 

    // UNIQUE KEY for Tasks based on currentUser
    const TASKS_KEY = `mindBuddyTasks_${currentUser}`;

    function getTasks(dateKey) {
        const data = localStorage.getItem(TASKS_KEY);
        const allTasks = data ? JSON.parse(data) : {};
        return allTasks[dateKey] || [];
    }

    function saveTasks(dateKey, tasksArray) {
        const data = localStorage.getItem(TASKS_KEY);
        const allTasks = data ? JSON.parse(data) : {};
        allTasks[dateKey] = tasksArray;
        localStorage.setItem(TASKS_KEY, JSON.stringify(allTasks));
    }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        monthYear.textContent = new Date(year, month).toLocaleString('default', { month: 'long', year: 'numeric' });
        
        calendarDays.innerHTML = '';
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let padding = firstDay === 0 ? 6 : firstDay - 1;

        for(let i=0; i<padding; i++) calendarDays.appendChild(document.createElement('div'));

        for(let i=1; i<=daysInMonth; i++) {
            const dayEl = document.createElement('div');
            dayEl.textContent = i;
            const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            
            if(dateKey === selectedDateKey) dayEl.classList.add('selected');
            if(getTasks(dateKey).length > 0) dayEl.classList.add('has-tasks');

            dayEl.onclick = () => {
                selectedDateKey = dateKey;
                selectedDateDisplay.textContent = new Date(year, month, i).toDateString();
                renderCalendar(); 
                renderTasks();
            };
            calendarDays.appendChild(dayEl);
        }
    }

    function renderTasks() {
        taskList.innerHTML = '';
        const tasks = getTasks(selectedDateKey);
        
        if(tasks.length === 0) {
            taskList.innerHTML = '<li style="color:#777; text-align:center;">No tasks for this day.</li>';
            return;
        }

        tasks.sort((a,b) => a.time.localeCompare(b.time));

        tasks.forEach((task, index) => {
            const li = document.createElement('li');
            li.className = `task-item ${task.completed ? 'completed' : ''}`;
            li.innerHTML = `
                <span><span class="task-time">${task.time}</span> <span class="task-text">${task.text}</span></span>
                <div class="task-actions">
                    <button class="task-action-btn btn-check" onclick="toggleTask(${index})"><i class="fas fa-check"></i></button>
                    <button class="task-action-btn btn-delete" onclick="deleteTask(${index})"><i class="fas fa-times"></i></button>
                </div>
            `;
            taskList.appendChild(li);
        });
    }

    function addTask() {
        const timeInput = document.getElementById('task-time').value;
        const textInput = document.getElementById('task-input').value;
        if(!timeInput || !textInput) return alert("Please pick a time and enter a task.");
        
        const tasks = getTasks(selectedDateKey);
        tasks.push({ time: timeInput, text: textInput, completed: false });
        saveTasks(selectedDateKey, tasks);
        
        document.getElementById('task-input').value = '';
        renderTasks();
        renderCalendar(); 
    }

    window.toggleTask = function(index) {
        const tasks = getTasks(selectedDateKey);
        tasks[index].completed = !tasks[index].completed;
        saveTasks(selectedDateKey, tasks);
        renderTasks();
    }

    window.deleteTask = function(index) {
        if(confirm('Delete this task?')) {
            const tasks = getTasks(selectedDateKey);
            tasks.splice(index, 1);
            saveTasks(selectedDateKey, tasks);
            renderTasks();
            renderCalendar(); 
        }
    }

    document.getElementById('prev-month').onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); };
    document.getElementById('next-month').onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); };

    // --- 5. FOCUS TIMER (Logic kept same) ---
    let timerInterval;
    let timeLeft = 25 * 60;

    function updateTimerDisplay() {
        const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        const s = (timeLeft % 60).toString().padStart(2, '0');
        document.getElementById('timer-display').textContent = `${m}:${s}`;
    }

    function startTimer() {
        if(timerInterval) return;
        timerInterval = setInterval(() => {
            if(timeLeft > 0) {
                timeLeft--;
                updateTimerDisplay();
            } else {
                clearInterval(timerInterval);
                alert("Time's up!");
            }
        }, 1000);
    }
    
    function pauseTimer() { clearInterval(timerInterval); timerInterval = null; }
    function resetTimer() { pauseTimer(); timeLeft = 25 * 60; updateTimerDisplay(); }
    function setBreak() { pauseTimer(); timeLeft = 5 * 60; updateTimerDisplay(); }

    // --- INITIALIZATION ---
    renderMoodTable();
    renderCalendar();
    renderTasks();
    selectedDateDisplay.textContent = new Date().toDateString();

  

</script>
</body>

</html>
